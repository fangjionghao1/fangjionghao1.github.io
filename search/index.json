[{"content":"èƒŒæ™¯ ç³»ç»Ÿä¸­æœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡ã€‚éƒ¨ç½²ç¯å¢ƒwindows2003r,æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ linux çš„ crontab æ¥åšå®šæ—¶ä»»åŠ¡ï¼Œå¦å¤–å°±æ˜¯ç¼–è¯‘æˆä¸€ä¸ªä¸€ä¸ªå°å·¥å…·ï¼Œæ¯æ¬¡æœ‰æ–°çš„å®šæ—¶ä»»åŠ¡å°±è¦åšä¸€ä¸ªæ–°çš„å°å·¥å…·ã€‚è€Œä¸”ä»£ç å…¨å°è£…ï¼Œåƒæ˜¯ä¸€ä¸ªä¸ª dll,å¦‚æœæœ‰é—®é¢˜ä¸å¥½è°ƒè¯•ã€‚ ä¸ºæ­¤è€ƒè™‘åˆ¶ä½œä¸€ä¸ªå®šæ—¶ä»»åŠ¡è°ƒåº¦çš„å°ç³»ç»Ÿã€‚\næ€è·¯ éœ€è¦åšçš„åŠŸèƒ½ä»åº•ä¸‹åˆ°ä¸Šå±‚åˆ†åˆ«æœ‰\næœ€ä¸‹å±‚-å†…å­˜è®¡æ—¶å™¨: è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒï¼Œå°±æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå’Œä¼ ç»Ÿæ¦‚å¿µé‡Œçš„å®šæ—¶å™¨æ²¡æœ‰åŒºåˆ«ï¼Œè®¾ç½®å¼€å§‹æ—¶é—´ï¼Œé—´éš”æ—¶é—´ï¼Œæ³¨å†Œå›è°ƒï¼Œè®©å‡½æ•°åœ¨å¼€å§‹æ—¶é—´ç»è¿‡æŒ‡å®šé—´éš”æ—¶é—´ä¹‹åæ‰§è¡Œå›è°ƒå‡½æ•°\nç¬¬äºŒå±‚-èµ‹äºˆæ•°æ®æŒä¹…èƒ½åŠ›ï¼š\nç›®çš„ï¼šåŠ å…¥æœåŠ¡å™¨å¼‚å¸¸ä¸­æ–­ï¼Œå®šæ—¶ä»»åŠ¡å°±ä¼šè¢«æ‰“ä¹±ã€‚ å› ä¸ºå†…å­˜åªæœ‰ç³»ç»Ÿå¯åŠ¨çš„æ—¶é—´è¿™ä¸ªä¿¡æ¯ï¼Œå®šæ—¶ä»»åŠ¡é‡è¦çš„æ˜¯å¼€å§‹æ—¶é—´ï¼Œè¿™å½±å“äº†ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ åšæ³•ï¼šæŒä¹…å†…å­˜ä¸­çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ ä»»åŠ¡çš„åç§°ï¼ˆå…³é”®å­—ï¼‰ï¼šç”¨äºå’Œå›è°ƒç»‘å®š ä»»åŠ¡çš„å¼€å§‹æ—¶é—´ ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´ é—´éš”æ—¶é—´ æ˜¯å¦é‡å¤ï¼ˆå¯é€‰ï¼‰ å›è°ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºäº†èµ‹äºˆå›è°ƒå‡½æ•°æ›´å¼ºçš„èƒ½åŠ›ï¼Œè®°å½•å›è°ƒå‡½æ•°éœ€è¦ç”¨åˆ°çš„å‚æ•°ï¼Œå°±åƒä¸€æ¬¡ rpc è°ƒç”¨ä¸€æ ·ï¼Œåªä¸è¿‡è¿™æ¬¡å‘èµ·æ–¹æ˜¯ç³»ç»Ÿï¼Œå“åº”åœ¨æœªæ¥ï¼Œè¿”å›åˆ°ç°åœ¨ã€‚ è¶…æœŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰ï¼šè¿‡äº†æŒ‡å®šæ—¶é—´å°±åºŸå¼ƒè¿™ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨æ‰«æçš„æ—¶å€™è·³è¿‡ ä¹Ÿä¼šåˆ é™¤ç›¸åº”çš„è®°å½• å‚è€ƒç”¨çš„è¡¨ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 CREATE TABLE `timer_stores` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `fire_time` datetime(3) NOT NULL, `interval` varchar(15) NOT NULL, `key` varchar(30) DEFAULT NULL, `repeat` tinyint(1) DEFAULT NULL, `data` longtext, `belong_user` bigint(20) DEFAULT NULL, `expire` bigint(20) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=86 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci; ç¬¬ä¸‰å±‚ å¯ä»¥ç†è§£æˆåº”ç”¨å±‚\næ³¨å†Œå¤§é‡çš„å›è°ƒå‡½æ•°å»å’Œå…³é”®å­—ç»‘å®šï¼Œå½“éœ€è¦æŸç§åŠŸèƒ½çš„æ—¶å€™å°±å¯ä»¥æ ¹æ®å…³é”®å­—èµ‹äºˆå®šæ—¶å™¨æŒ‡å®šçš„åŠŸèƒ½ æ‰©å±•ï¼š è®¾ç½®å¯åœçš„å…³é”®å­—ï¼Œå¯ä»¥è·³è¿‡æŸäº›å®šæ—¶å™¨ è¿™ä¸ªæ˜¯åº”ç”¨çš„åŸºæœ¬ç»“æ„ï¼Œé‚£ä¹ˆä»£ç çš„é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼Œç®€å•æå‡ ä¸ªçŠ¶æ€æè¿°ä¸€ä¸‹åé¢ç›´æ¥ä¸Šä»£ç \næœåŠ¡å¯åŠ¨çŠ¶æ€ï¼šè¿™ä¸ªçŠ¶æ€è¦åšçš„æœ‰ æŒä¹…å±‚è·å–å®šæ—¶å™¨çš„æ•°æ®ä¿¡æ¯ æ³¨å†Œå›è°ƒä¿¡æ¯ å¯åŠ¨å†…å­˜å®šæ—¶å™¨ï¼ˆä¸€å®šè¦å…ˆæ³¨å†Œå›è°ƒæ‰èƒ½å¯åŠ¨å†…å­˜å®šæ—¶å™¨ï¼Œä½†æ˜¯å†…å­˜å®šæ—¶å™¨å’ŒæŒä¹…è°å…ˆè°åæ— æ‰€è°“ï¼‰ å®šæ—¶å™¨è§¦å‘é˜¶æ®µï¼Œæ ¹æ® ID æ›´æ–°ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´ ä»£ç ç¤ºä¾‹ æŒä¹…å±‚è®¡æ—¶å™¨ 1 2 3 4 5 6 7 8 9 10 // TimerStore @Description: è®¡æ—¶å™¨å­˜å‚¨å®ä½“ type TimerStore struct { Id uint64 `gorm:\u0026#34;type:bigint(20) AUTO_INCREMENT;not null;primaryKey;column:id\u0026#34; json:\u0026#34;id,omitempty\u0026#34;` FireTime db.MpsTime `gorm:\u0026#34;column:fire_time;type:time\u0026#34; json:\u0026#34;fireTime\u0026#34;` Interval db.MpsDuration `gorm:\u0026#34;column:interval;type:varchar(30)\u0026#34; json:\u0026#34;interval,omitempty\u0026#34;` Key string `gorm:\u0026#34;column:key;type:varchar(15)\u0026#34; json:\u0026#34;key,omitempty\u0026#34;` Repeat bool `gorm:\u0026#34;column:repeat;type\u0026#34; json:\u0026#34;repeat,omitempty\u0026#34;` Data string `gorm:\u0026#34;column:data;type:varchar(255)\u0026#34; json:\u0026#34;data,omitempty\u0026#34;` BelongUser *int `gorm:\u0026#34;column:belong_user;type:bigint(20)\u0026#34; json:\u0026#34;belongUser,omitempty\u0026#34;` } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 // UpdateTimerInDb2NextFireTimeCallBack change timer fire time func UpdateTimerInDb2NextFireTimeCallBack(store TimerStore) func() { data, id, key, repeat, interval := store.Data, store.Id, store.Key, store.Repeat, store.Interval // ä¸ºäº†è®©å›è°ƒéœ€è¦çš„å˜é‡éƒ½é™åˆ¶åœ¨è¯¥å‡½æ•°å†… return func() { tx := db.DB.Model(\u0026amp;TimerStore{}).Where(\u0026#34;id = ?\u0026#34;, id) defer func() { if !repeat \u0026amp;\u0026amp; id != 0 { // è¡¨ç¤ºåœ¨æ•°æ®åº“ä¸­æœ‰æ•°æ® tx.Delete(\u0026amp;TimerStore{}) //å¦‚æœä¸é‡å¤å°±åˆ é™¤ç›¸å…³çš„å®šæ—¶å™¨ } else if id != 0 { // repeat if err := tx.UpdateColumn(\u0026#34;fire_time\u0026#34;, time.Now().Add(time.Duration(interval))).Error; err != nil { logger.Log.Errorf(\u0026#34;update fire time in db error %v\u0026#34;, err) } } }() if f := callBack.GetFunc(key); f != nil { // è·å–å›è°ƒ å¦‚æœæ²¡æœ‰å°±ä¸æ‰§è¡Œ å¦‚æœå¼€å…³æ²¡æœ‰å¼€å¯åˆ™è·å¾—ä¸€ä¸ªå‡å›è°ƒ if err := callBack.GetFunc(key)(data); err != nil { logger.Log.Errorf(\u0026#34;timer call back func error %v\u0026#34;, err) return } } } } // AddTimer æ·»åŠ è®¡æ—¶å™¨ å¤„ç†æ•°æ®åº“æ•°æ®å’Œå †æ•°æ® func AddTimer(t ...TimerStore) error { // å¯¹åŠ å…¥çš„è®¡æ—¶å™¨è¿›è¡Œåˆ¤å®š ä¸šåŠ¡è®¡æ—¶å™¨å’Œæ¢å¤è®¡æ—¶å™¨åˆ†å¼€å¤„ç† for idx := range t { timerStore := t[idx] // é˜²æ­¢ä¸‹é¢ä½¿ç”¨å®šæ—¶å™¨ä¸­çš„æŒ‡é’ˆ duration := time.Duration(timerStore.Interval) if duration == 0 \u0026amp;\u0026amp; timerStore.Repeat { return errors.New(\u0026#34;no repeat task need interval\u0026#34;) } if timerStore.FireTime.IsZero() { // å¦‚æœå¼€å§‹æ—¶é—´ä¸ºç©ºåˆ™å¯¹å¼€å§‹æ—¶é—´èµ‹äºˆä¸€ä¸ªåˆå€¼ timerStore.FireTime.Time = time.Now().Add(duration) } switch true { case t[idx].Id != 0: // è¡¨ç¤ºåœ¨æ•°æ®åº“ä¹‹ä¸­ if timerStore.FireTime.Before(time.Now()) { // å¤„ç†æ—¶é—´é—®é¢˜ if duration != 0 { timerStore.FireTime.Time = time.Now().Add(timerStore.FireTime.Sub(time.Now()) % duration).Add(duration) // æ›´æ–°æ•°æ®åº“ } else { timerStore.FireTime.Time = time.Now() } if err := db.DB.Model(\u0026amp;timerStore).Where(\u0026#34;id = ?\u0026#34;, timerStore.Id).Update(\u0026#34;fire_time\u0026#34;, timerStore.FireTime).Error; err != nil { return err } } // ä¸æ—©äºå½“å‰ä¸åšç›¸åº”å¤„ç† default: // è¡¨ç¤ºä¸åœ¨æ•°æ®åº“ä¹‹ä¸­ if err := db.DB.Model(\u0026amp;timerStore).Create(\u0026amp;timerStore).Error; err != nil { // æ²¡åœ¨æ•°æ®åº“ä¸­å°±æ·»åŠ æ•°æ®åº“è·å–id ä¸ç®¡æ—¶é—´çŸ­ä¸çŸ­ return err } } timerHeap.H.AddTimers(timerHeap.Timer{ID: timerStore.Id, FireTime: timerStore.FireTime.Time, Repeat: timerStore.Repeat, Interval: duration, Tag: timerStore.Key}, UpdateTimerInDb2NextFireTimeCallBack(timerStore)) } return nil } // InitTh åˆå§‹åŒ–å®šæ—¶å † func InitTh(d time.Duration) { var res []TimerStore err := db.DB.Model(\u0026amp;TimerStore{}).Find(\u0026amp;res).Error if err != nil { logger.Log.Errorf(\u0026#34;rerieve timer store error %v\u0026#34;, err) } if err = AddTimer(res...); err != nil { logger.Log.Fatal(err) } timerHeap.H.StartTicks(d) } // RemoveTimerStore ç§»é™¤æ‰è®¡æ—¶å™¨ ä¸ºäº†æ–¹å¼åªåˆ é™¤å†…å­˜æˆ–è€…æ•°æ®åº“æŸä¸€è¾¹çš„è®¡æ—¶å™¨ å»ºè®®ä½¿ç”¨è¿™ä¸ªæ–¹å¼åˆ é™¤ func RemoveTimerStore(id uint64) error { err := db.DB.Model(\u0026amp;TimerStore{}).Where(\u0026#34;id = ?\u0026#34;, id).Delete(TimerStore{}).Error if err != nil { return err } timerHeap.H.Remove(id) return nil } å†…å­˜è®¡æ—¶å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 package timerHeap import ( \u0026#34;container/heap\u0026#34; \u0026#34;mps/common/db\u0026#34; \u0026#34;mps/logger\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) var H = NewTimerHeap() const ( MinTimerInterval = 10 * time.Millisecond // å¾ªç¯å®šæ—¶å™¨çš„æœ€å°æ—¶é—´é—´éš” ) const ( defaultMode uint8 = iota goroutineMode ) func (th *TimerHeap) ListTimer() (res []Timer) { th.lock.Lock() defer th.lock.Unlock() for _, timer := range th.timers { res = append(res, *timer) } return res } // CallbackFunc å®šæ—¶å™¨å›è°ƒå‡½æ•°çš„ç±»å‹å®šä¹‰ type CallbackFunc func() // Timer å®šæ—¶å™¨å¯¹è±¡ type Timer struct { ID uint64 // å¤–éƒ¨Id (å”¯ä¸€, ç”¨äºæ›´æ–°å’Œç§»é™¤æŒ‡å®šçš„å®šæ—¶å™¨) FireTime time.Time // è§¦å‘æ—¶é—´ Interval time.Duration // æ—¶é—´é—´éš”ï¼ˆç”¨äºå¾ªç¯å®šæ—¶å™¨ï¼‰ Tag string // ç”¨äºæºå¸¦å¿…è¦çš„å¤–éƒ¨ä¿¡æ¯ï¼Œæ‰©å±•ä½¿ç”¨ï¼Œä»…ä½œä¸ºä¿¡æ¯å±æ€§ callback CallbackFunc // å›è°ƒå‡½æ•° Repeat bool // æ˜¯å¦å¾ªç¯ cancelled bool // æ˜¯å¦å·²ç»å–æ¶ˆ addSeq uint // åºå·,è‡ªå¢ } // Cancel å–æ¶ˆä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿™ä¸ªå®šæ—¶å™¨å°†ä¸ä¼šè¢«è§¦å‘ func (t *Timer) Cancel() { t.cancelled = true } // IsActive åˆ¤æ–­å®šæ—¶å™¨æ˜¯å¦å·²ç»å–æ¶ˆ func (t *Timer) IsActive() bool { return !t.cancelled } type TimeFmt struct { T db.MpsTime Id uint64 } // TimerHeap ä½¿ç”¨ä¸€ä¸ªheapç®¡ç†æ‰€æœ‰çš„å®šæ—¶å™¨ type TimerHeap struct { timers []*Timer hooks map[string][]func(timer *Timer) // hooks // @Description: ä¸€ç»„å›è°ƒ å¯¹æ¯ä¸€ä¸ªpopå‡ºæ¥çš„è®¡æ—¶å™¨è¿›è¡Œä¸€äº›æ“ä½œ openHook bool // openHook // @Description: é’©å­å¼€å…³ nextAddSeq uint poolSize int expire time.Duration invokeMode uint8 stop bool lock sync.Mutex } // Len å †æ’åºæ¥å£å®ç° func (th *TimerHeap) Len() int { return len(th.timers) } func (th *TimerHeap) Less(i, j int) bool { if th.timers[i].FireTime.Before(th.timers[j].FireTime) { return true } if th.timers[i].FireTime.After(th.timers[j].FireTime) { return false } // ä¸¤ä¸ªtimerçš„è§¦å‘æ—¶é—´ä¸€è‡´æ—¶ï¼ŒæŒ‰å…¶å…¥å †çš„é¡ºåº return th.timers[i].ID \u0026lt; th.timers[j].ID } func (th *TimerHeap) Swap(i, j int) { th.timers[i], th.timers[j] = th.timers[j], th.timers[i] } func (th *TimerHeap) Push(x interface{}) { th.timers = append(th.timers, x.(*Timer)) } func (th *TimerHeap) Pop() (ret interface{}) { l := len(th.timers) th.timers, ret = th.timers[:l-1], th.timers[l-1] return } // Update ä¿®æ”¹æŒ‡å®šçš„idçš„Timerçš„è§¦å‘æ—¶é—´ func (th *TimerHeap) Update(id uint64, nt time.Time) { th.lock.Lock() defer th.lock.Unlock() for k, v := range th.timers { if v.ID == id { v.FireTime = nt heap.Fix(th, k) break } } } // Remove åˆ é™¤æŒ‡å®šçš„idçš„Timer // tips: æ— ç»‘å®šindex filed, åœ¨forå¾ªç¯ä¸­ä¸èƒ½ä½¿ç”¨heap.Remove()æ¥åˆ é™¤æŒ‡å®šé¡¹ï¼›å› ä¸ºheap.Removeçš„è¿‡ç¨‹ä¸­æœ‰ä¸€æ¬¡ç§»åŠ¨è‡³æœ«å°¾ï¼Œforå¯èƒ½å†æ¬¡åŒ¹é…åˆ° func (th *TimerHeap) Remove(id uint64) int { th.lock.Lock() defer th.lock.Unlock() n := 0 for k, v := range th.timers { if v.ID == id { th.timers = append(th.timers[:k], th.timers[k+1:]...) n++ } } heap.Init(th) return n } // Peek æŸ¥çœ‹æŸä¸ªæŒ‡å®šidçš„Timer func (th *TimerHeap) Peek(id uint64) *Timer { for _, v := range th.timers { if v.ID == id { return v } } return nil } // GetTimersWithTag è¯»å–æŒ‡å®štagçš„timersï¼Œä¸åŒ…å«cancelledä¸ºtrueçš„timer func (th *TimerHeap) GetTimersWithTag(tag string) []*Timer { var ret []*Timer for _, v := range th.timers { if v.Tag == tag \u0026amp;\u0026amp; v.cancelled == false { ret = append(ret, v) } } return ret } // NewTimerHeap æ–°å»ºä¸€ä¸ªå°é¡¶å †å®šæ—¶å™¨ func NewTimerHeap() *TimerHeap { var timerHeap TimerHeap heap.Init(\u0026amp;timerHeap) timerHeap.nextAddSeq = 1 timerHeap.invokeMode = defaultMode return \u0026amp;timerHeap } // NewTimerHeapWithGoroutine æ–°å»ºä¸€ä¸ªå°é¡¶å †å®šæ—¶å™¨, æ¯ä¸ªcallbackç‹¬ç«‹ä½¿ç”¨åç¨‹è¿è¡Œ func NewTimerHeapWithGoroutine() *TimerHeap { var timerHeap TimerHeap heap.Init(\u0026amp;timerHeap) timerHeap.nextAddSeq = 1 timerHeap.invokeMode = goroutineMode return \u0026amp;timerHeap } func (th *TimerHeap) AddTimers(timer Timer, callbackFunc CallbackFunc) *Timer { th.lock.Lock() if timer.Repeat { if timer.Interval \u0026lt; MinTimerInterval { timer.Interval = MinTimerInterval } } if timer.FireTime.IsZero() { timer.FireTime = time.Now().Add(timer.Interval) } timer.callback = callbackFunc timer.addSeq = th.nextAddSeq th.nextAddSeq += 1 heap.Push(th, \u0026amp;timer) th.lock.Unlock() return \u0026amp;timer } // Tick å¯¹å®šæ—¶å™¨æ¨¡å—è¿›è¡Œä¸€æ¬¡Tick func (th *TimerHeap) Tick() { now := time.Now() th.lock.Lock() defer th.lock.Unlock() for { // æ²¡æœ‰ä»»ä½•å®šæ—¶å™¨ï¼Œè¿”å› if th.Len() \u0026lt;= 0 { break } //å †é¡¶,æ²¡æœ‰åˆ°æ—¶é—´çš„å®šæ—¶å™¨ï¼Œè¿”å› if th.timers[0].FireTime.After(now) { break } // ä»heapä¸­æ‹¿å‡ºå †é¡¶ t := heap.Pop(th).(*Timer) // å¿½ç•¥å·²ç»å–æ¶ˆçš„å®šæ—¶å™¨ if t.cancelled { continue } // éå‘¨æœŸä»»åŠ¡ï¼Œåˆ™ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­Pop() if !t.Repeat { t.cancelled = true } // åŒæ­¥åç¨‹æ‰§è¡Œå›è°ƒ if th.invokeMode == defaultMode { runCallback(t.ID, t.callback) } // å¼‚æ­¥åç¨‹æ‰§è¡Œå›è°ƒ if th.invokeMode == goroutineMode { go func() { runCallback(t.ID, t.callback) }() } // å¦‚æœæ˜¯å¾ªç¯timerå°±æŠŠTimeré‡æ–°æ”¾å›heapä¸­ if t.Repeat { t.FireTime = t.FireTime.Add(t.Interval) if !t.FireTime.After(now) { t.FireTime = now.Add(t.Interval) } t.addSeq = th.nextAddSeq th.nextAddSeq += 1 heap.Push(th, t) } } } //func runHook(timer *Timer, fs ...func(timer *Timer)) error { //\tfor _, f := range fs { //\tf(timer) //\t} //} // AddRepeatTimerWithFixedMoment è®¾ç½®ä¸€ä¸ªå®šæ—¶è§¦å‘çš„å›è°ƒï¼Œæ¯æ—¥çš„å›ºå®šæ—¶åˆ»(æ—¶åˆ†ç§’ï¼ŒUTCæ—¶é—´)æ‰§è¡Œï¼Œå¹¶è°ƒç”¨callbackå‡½æ•° //func (th *TimerHeap) AddRepeatTimerWithFixedMoment(h, m, s int, callback CallbackFunc, id uint64, tag string) *Timer { //\tnow := time.Now() //\tnext := time.Date(now.Year(), now.Month(), now.Day(), h, m, s, 0, time.UTC) //\tvar wait time.Duration //\tif next.Sub(now) \u0026gt; 0 { //\twait = next.Sub(now) //\t} else { //\ttomorrow := time.Date(now.Add(24*time.Hour).Year(), now.Add(24*time.Hour).Month(), now.Add(24*time.Hour).Day(), h, m, s, 0, time.UTC) //\twait = tomorrow.Sub(now) //\t} //\tt := \u0026amp;Timer{ //\tID: id, //\tFireTime: time.Now().Add(wait), //\tInterval: 24 * time.Hour, //\tTag: tag, //\tcallback: callback, //\tRepeat: true, //\t} //\tth.lock.Lock() //\tt.addSeq = th.nextAddSeq //\tth.nextAddSeq += 1 //\theap.Push(th, t) //\tth.lock.Unlock() //\treturn t //} // AddRepeatTimerNextClock è®¾ç½®ä¸€ä¸ªå®šæ—¶è§¦å‘çš„å›è°ƒï¼Œä¸‹ä¸€ä¸ªæ•´ç‚¹æ—¶é—´å¼€å§‹æ‰§è¡Œï¼Œæ¯é—´éš”dæ—¶é—´é‡å¤è§¦å‘ï¼Œå¹¶è°ƒç”¨callbackå‡½æ•° //func (th *TimerHeap) AddRepeatTimerNextClock(d time.Duration, callback CallbackFunc, id uint64, tag string) *Timer { //\tt1, _ := time.ParseInLocation(\u0026#34;2006-01-02 15:04:05\u0026#34;, time.Now().Format(\u0026#34;2006-01-02 15:00:00\u0026#34;), time.UTC) //\twait := time.Duration(t1.Truncate(1*time.Hour).Unix() + 3600 - time.Now().Unix()) //\tt := \u0026amp;Timer{ //\tID: id, //\tFireTime: time.Now().Add(wait), //\tInterval: d, //\tTag: tag, //\tcallback: callback, //\tRepeat: true, //\t} //\tth.lock.Lock() //\tt.addSeq = th.nextAddSeq //\tth.nextAddSeq += 1 //\theap.Push(th, t) //\tth.lock.Unlock() //\treturn t //} // StartTicks åˆ›å»ºä¸€ä¸ªgoroutineå¯¹å®šæ—¶å™¨æ¨¡å—è¿›è¡Œå®šæ—¶çš„Tick func (th *TimerHeap) StartTicks(tickInterval time.Duration) { //th.stop = false //go func() { //\tfor th.stop { // //\t} //}() go th.selfTickRoutine(tickInterval) } func (th *TimerHeap) Stop() { th.stop = true } func (th *TimerHeap) selfTickRoutine(tickInterval time.Duration) { if tickInterval \u0026lt; MinTimerInterval { tickInterval = MinTimerInterval } for { if th.stop { return } time.Sleep(tickInterval) th.Tick() } } // è¿è¡Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ï¼Œå¹¶æ•è·panicï¼Œå°†panicè½¬åŒ–ä¸ºé”™è¯¯è¾“å‡º func runCallback(id uint64, callback CallbackFunc) { defer func() { err := recover() if err != nil { logger.Log.Errorf(\u0026#34;Callback %v panic: %v\\n\u0026#34;, id, err) var buf [4096]byte n := runtime.Stack(buf[:], false) logger.Log.Errorf(\u0026#34;Callback exits from panic: %s\\n\u0026#34;, string(buf[:n])) } }() callback() } ","date":"2023-05-25T10:29:08+08:00","permalink":"https://fangjionghao1.github.io/p/%E6%8C%81%E4%B9%85%E5%AE%9A%E6%97%B6%E5%99%A8%E5%BD%92%E6%A1%A3%E6%95%B4%E7%90%86%E7%89%88/","title":"æŒä¹…å®šæ—¶å™¨ï¼ˆå½’æ¡£æ•´ç†ç‰ˆï¼‰"},{"content":"å…œå…œè½¬è½¬è¿˜æ˜¯ä¼šå›åˆ°èµ·ç‚¹ï¼Œæœ‰ä»€ä¹ˆä¸ä¸€æ ·äº†ï¼Œæ¥æ—¶æ˜ç™½ï¼Œèµ°æ—¶æ›´æ˜ç™½ã€‚\nåˆä¼‘çœ‹åˆ°éŸ³ä¹çš„ aigc ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦éŸ³ä¹é£æ ¼å°±èƒ½å¾—åˆ°ä¸€ä¸ªä¸é”™çš„ beat,éšä¾¿å¬äº†ä¸€é¦– trap,è´¨é‡çœŸçš„ä¸é”™ï¼Œæ•ˆæœå™¨è°ƒæ•™çš„å¾ˆé€‚åˆæ ‡ç­¾ï¼Œç”šè‡³åšäº†ä¾§é“¾å‹ç¼© æƒ³èµ·æ¥ä¹‹å‰å’Œå­¦é•¿è®¨è®ºçš„ï¼Œå¤å…¸å’Œç”µå­çš„é—®é¢˜ï¼Œåªä¸è¿‡å½“æ—¶ä¸»ä½“æ˜¯åˆéŸ³ä»Šå¤©ä¸»ä½“æ¢æˆäº† ai å­¦é•¿åƒå¤å“ˆå“ˆå“ˆå“ˆå“ˆ 0522\n","date":"2023-05-23T05:40:19.432Z","permalink":"https://fangjionghao1.github.io/p/%E9%9A%8F%E6%89%8B%E8%AE%B0/","title":"éšæ‰‹è®°"},{"content":"æœ¨æ¼ã‚Œæ—¥ ç½—é©¬éŸ³ komorebi æ—¥ hi å‘ç”Ÿè¿æµŠå˜æˆ bi ä¸­é«˜å‹ ä¸œäº¬æ–¹è¨€ ko é«˜ more ä½é«˜ bi é«˜ ko æœ¨ more æ¼^ã‚‚ ã‚Œ æ´©éœ²ï¼Œç©¿é æ˜¯æ¼^ã‚‚ ã‚Œã‚‹ moreru çš„è¿ç”¨å‹ morata æ¼^ã‚‚ ã‚Œæ˜¯è¿‡å»å¼\n","date":"2023-05-22T11:01:41+08:00","permalink":"https://fangjionghao1.github.io/p/%E6%97%A5%E8%AF%AD%E5%8D%95%E8%AF%8D/","title":"æ—¥è¯­å•è¯"},{"content":"èƒŒæ™¯ ä»è¡¨æ ¼å¯¼å…¥ä¸€äº›ç”¨æˆ·æ•°æ® é¡ºæ‰‹å¼€å‘äº†è¿™äº›å·¥å…·ã€‚ æœ¬æ–‡çš„å‰ææ˜¯äº†è§£äº†åŸºæœ¬å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼Œå› ä¸ºæœ‰ä¸­æ–‡æ–‡æ¡£å°±ä¸å†èµ˜è¿° excelize æ–‡æ¡£åœ°å€\né€‚ç”¨åœºæ™¯ ä»»ä½•äºŒç»´è¡¨æ ¼éƒ½å¯ä»¥ç”¨è¿™ç§æ–¹å¼åšç»Ÿè®¡\næ€è·¯ç®€è¿° æ‰¾åˆ°ä¸€ä¸ªè¡¨æ ¼çš„è¾¹ç•Œï¼Œåœ¨è¡¨æ ¼èŒƒå›´å†…çš„å†…å®¹éå†å¹¶æ ¹æ®å‚æ•°æŒ‰è¡Œåˆ—è¿›è¡Œè¯»å–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 var rwM sync.RWMutex // è¯»å†™é” var chMap = map[string]int{ \u0026#34;A\u0026#34;: 1, \u0026#34;B\u0026#34;: 2, \u0026#34;C\u0026#34;: 3, \u0026#34;D\u0026#34;: 4, \u0026#34;E\u0026#34;: 5, \u0026#34;F\u0026#34;: 6, \u0026#34;G\u0026#34;: 7, \u0026#34;H\u0026#34;: 8, \u0026#34;I\u0026#34;: 9, \u0026#34;J\u0026#34;: 10, \u0026#34;K\u0026#34;: 11, \u0026#34;L\u0026#34;: 12, \u0026#34;M\u0026#34;: 13, \u0026#34;N\u0026#34;: 14, \u0026#34;O\u0026#34;: 15, \u0026#34;P\u0026#34;: 16, \u0026#34;Q\u0026#34;: 17, \u0026#34;R\u0026#34;: 18, \u0026#34;S\u0026#34;: 19, \u0026#34;T\u0026#34;: 20, \u0026#34;U\u0026#34;: 21, \u0026#34;V\u0026#34;: 22, \u0026#34;W\u0026#34;: 23, \u0026#34;X\u0026#34;: 24, \u0026#34;Y\u0026#34;: 25, \u0026#34;Z\u0026#34;: 26, }// æšä¸¾ var chArr = charArr{ \u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;, \u0026#34;E\u0026#34;, \u0026#34;F\u0026#34;, \u0026#34;G\u0026#34;, \u0026#34;H\u0026#34;, \u0026#34;I\u0026#34;, \u0026#34;J\u0026#34;, \u0026#34;K\u0026#34;, \u0026#34;L\u0026#34;, \u0026#34;M\u0026#34;, \u0026#34;N\u0026#34;, \u0026#34;O\u0026#34;, \u0026#34;P\u0026#34;, \u0026#34;Q\u0026#34;, \u0026#34;R\u0026#34;, \u0026#34;S\u0026#34;, \u0026#34;T\u0026#34;, \u0026#34;U\u0026#34;, \u0026#34;V\u0026#34;, \u0026#34;W\u0026#34;, \u0026#34;X\u0026#34;, \u0026#34;Y\u0026#34;, \u0026#34;Z\u0026#34;, } func (c *charArr) Translate(str string) Point { strRunes := []rune(str) colArr := make([]rune, 0) rowArr := make([]rune, 0) for _, strRune := range strRunes { switch strRune \u0026gt; 64 { case false: rowArr = append(rowArr, strRune) case true: colArr = append(colArr, strRune) } } var col int // ä¸ºäº†æ–¹ä¾¿é™åˆ¶åœ¨26*26*26 switch len(colArr) { case 3: col = chMap[string(colArr[0])]*26*26 + chMap[string(colArr[1])]*26 + chMap[string(colArr[2])] case 2: col = chMap[string(colArr[0])]*26 + chMap[string(colArr[1])] case 1: col = chMap[string(colArr[0])] } var rowStr string for _, r := range rowArr { rowStr += string(r) } atoi, err := strconv.Atoi(rowStr) if err != nil { return Point{} } return Point{Col: col, Row: atoi} } type Point struct { Row int Col int } func (p *Point) NextCol() { p.Col += 1 } func (p *Point) NextRow() { p.Row += 1 } func (p *Point) trans() string { return chArr.GetAxis(*p) } func GetPoint(s string) Point { return chArr.Translate(s) } type ReadWay int const ( Col = ReadWay(1) // æŒ‰åˆ—èšåˆ Row = ReadWay(2) // æŒ‰è¡Œèšåˆ ) type ReadParam struct { Point Point Way ReadWay FileName string Sheet string EndPoint Point } func OpenFile(fileName string) (*excelize.File, error) { file, err := excelize.OpenFile(fileName) if err != nil { logger.Log.Errorf(\u0026#34;open excel file error %v\u0026#34;, err) return nil, err } return file, err } // ReadListFromPoint /* ã€Descriptionã€‘: ä»ä¸€ä¸ªç‚¹å‡ºå‘ åœ¨end point ä¹‹é—´çš„è¡¨æ ¼åšå‡ºç»Ÿè®¡ */ func ReadListFromPoint(p ReadParam) (map[string][]string, error) { file, err := OpenFile(p.FileName) if err != nil { return nil, err } defer func() { file.Close() }() m := make(map[string][]string) switch p.Way { case Col: // æŒ‰åˆ—èšåˆ startCol := p.Point.Col for p.Point.Row \u0026lt; p.EndPoint.Row { p.Point.NextRow() trans := p.Point.trans() idx, err := file.GetCellValue(p.Sheet, trans) if err != nil { return nil, err } for p.Point.Col \u0026lt; p.EndPoint.Col { p.Point.NextCol() val, _ := file.GetCellValue(p.Sheet, p.Point.trans()) m[idx] = append(m[idx], val) } p.Point.Col = startCol } case Row: // æŒ‰è¡Œèšåˆ startRow := p.Point.Row for p.Point.Col \u0026lt; p.EndPoint.Col { p.Point.NextCol() trans := p.Point.trans() idx, err := file.GetCellValue(p.Sheet, trans) if err != nil { return nil, err } for p.Point.Row \u0026lt; p.EndPoint.Row { p.Point.NextRow() val, _ := file.GetCellValue(p.Sheet, p.Point.trans()) m[idx] = append(m[idx], val) } p.Point.Row = startRow } } return m, nil } æ¯”è¾ƒå‘çš„åœ°æ–¹æ˜¯ç”¨å®˜æ–¹çš„æŒ‰è¡Œè¯»å–è¯»è¡Œæ ‡é¢˜çš„æ—¶å€™ä¼šå¯¼è‡´ä¹‹å‰è¯»å–çš„æ•°æ®è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ map ä¸­çš„æ•°æ®è¢«æ¸…ç©ºã€‚ å»ºè®®æ˜¯æ·±åº¦æ‹·è´å†è¿›è¡ŒæŒ‰è¡Œåˆ—è¯»å–\n","date":"2023-02-24T00:00:00Z","permalink":"https://fangjionghao1.github.io/p/%E5%B7%A5%E5%85%B7/","title":"excelize åº“ç®€ä»‹"},{"content":"è¿è½½ä¸­ã€‚ã€‚ã€‚æ¬¢è¿è¡¥å…… GO ç¯‡ go æ˜¯å¼ºç±»å‹çš„è¯­è¨€ï¼Œè¿™æ„å‘³ç€ï¼Œå˜é‡è¦è¢«æŒ‡å®šï¼ŒåŸºæœ¬ç±»å‹å˜é‡ä¸€è¯ç”Ÿå°±å¸¦ä¸Šç±»å‹ï¼Œå¸¦ä¸Šç±»å‹æ„å‘³ç€å æœ‰ç©ºé—´ï¼Œå¾ˆè‡ªç„¶èƒ½æƒ³åˆ°ï¼ŒåŸºæœ¬ç±»å‹çš„ç©ºå€¼æ˜¯é»˜è®¤æœ‰å€¼çš„ï¼Œæ¯”å¦‚ int çš„ç©ºä¸º 0 ï¼Œstring ä¸º\u0026quot;\u0026quot;ã€‚æ‰€ä»¥åœ¨åºåˆ—åŒ–çš„æ—¶å€™è¿™éƒ¨åˆ†å†…å®¹å¦‚æœæƒ³è¦ä¸€ä¸ª null å€¼éœ€è¦ç»™ç»“æ„å®šä¹‰æŒ‡é’ˆã€‚ å®ç°æ¥å£çš„æ—¶å€™å¦‚æœæ˜¯æŒ‡é’ˆæ¥æ”¶è€…ï¼Œç‰¹åˆ«æ˜¯å®ç°å·¥å…·è‡ªå¸¦çš„æ¥å£ï¼Œæ¯”å¦‚ marshalï¼Œè¦ä½¿ç”¨å¼•ç”¨ã€‚ json åºåˆ—åŒ–çš„æ—¶å€™è¦å£°æ˜ä¸€ä¸ªä¸´æ—¶ç±»å‹ï¼Œå¦åˆ™ä¼šå› ä¸ºè‡ªèº«çš„åå¤è°ƒç”¨è€Œ stack overflow 1 2 3 4 5 6 7 8 9 10 func (g *Group) MarshalJSON() ([]byte, error) { type tmp Group return json.Marshal(\u0026amp;struct { *tmp CreateTimeStr string `json:\u0026#34;create_time\u0026#34;` }{ tmp: (*tmp)(g), CreateTimeStr: g.CreatTime.Format(consts.TLayout.Date), }) } go çš„æ—¶é—´ç±»å‹é»˜è®¤æ ¼å¼æ˜¯ YYYY-MM-DDTHH:MM:SSZ+0800,é›¶æ—¶é—´æ˜¯ 0001-01-01 00ï¼š00 +0000 æˆ‘çš„åšæ³•æ˜¯å¹´ä¸º 1 çš„æ—¶å€™åˆ¤ç©ºï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚ time ç±»å‹ç›´æ¥ string() æ¥å£è½¬å‡ºæ—¶é—´çš„æ—¶å€™ï¼Œå¹´æœˆæ—¥éƒ½æ˜¯å•ä½çš„æ¯”å¦‚ 3 æœˆå°±æ˜¯è¾“å‡º 3ï¼Œä½†æ˜¯ä¸€èˆ¬è¦è½¬å›æ—¶é—´çš„æ—¶å€™å°±éœ€è¦è½¬æ¢æˆ 03,æˆ‘çš„åšæ³•æ˜¯é™æ€çš„å¯¹åº”è¡¨ï¼Œæ”¾åœ¨ util é‡Œé¢éœ€è¦çš„æ—¶å€™å†ç”¨ã€‚ http ç¯‡ å‰ç«¯æ•°æ®ä¸å¯ä¿¡ï¼Œä¸åšä¿®æ”¹çš„æ—¶å€™ä»¥åç«¯æ•°æ®ä¸ºå‡†ï¼Œå”¯ä¸€å€¼å¾—å‚è€ƒçš„å°±æ˜¯æä¾›çš„èº«ä»½ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸ä»…é™äº id,tokenã€‚åšä¿®æ”¹æ—¶ä»¥å‰ç«¯æ•°æ®ä¸ºå‡†ã€‚ ç”±äºå‰åç«¯è¦äº¤æ¢æ•°æ®ï¼Œå…¶å®é€‰æ‹© string ä½œä¸ºäº¤æ¢çš„æ ¼å¼æŒºæœ‰é£é™©ã€‚ä¸¾ä¸ªä¾‹å­å°±æ˜¯æ—¶é—´é€‰ç”¨ string ç±»å‹çš„æ—¶å€™åæœæ˜¯æ¯æ¬¡äº¤äº’ä¸¤è¾¹éƒ½è¦è¿›è¡Œ å‰ç«¯æ˜¯æ²¡æœ‰åŠæ³•ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶çš„ã€‚åŸå› æ˜¯å‰ç«¯èƒ½å¤Ÿæ“ä½œçš„è¡Œä¸ºéƒ½æ˜¯åŸºäºæµè§ˆå™¨çš„ï¼Œæµè§ˆå™¨æ²¡æœ‰æ·±å…¥åˆ°æ“ä½œç³»ç»Ÿçš„æƒé™ï¼Œé™¤éæ˜¯åŠ ä¸€äº›é»‘ç§‘æŠ€ï¼Œæ‰èƒ½å¤Ÿåˆ°åº•å±‚ã€‚è¿™ä¹Ÿå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆå‰ç«¯ä¸èƒ½æ“ä½œç›´æ¥æ“ä½œå†…å­˜ï¼Œä¹Ÿå°±ä¸èƒ½è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œé™¤éæ˜¯ç”¨æˆ·æˆæƒï¼Œæ¯”å¦‚åœ¨multipartformå½“ä¸­æ“ä½œã€‚ Fiber ç¯‡ fiber æ³¨å†Œçš„ handler æ˜¯æœ‰å‰åé¡ºåºåˆ†åˆ«çš„ã€‚åŸå› æ˜¯ä»–åœ¨ç»™ app è®¾ç½® handler çš„æ—¶å€™åº•å±‚å®ç°æ˜¯ä¸€ä¸ª sliceã€‚å‰åè°ƒç”¨æœ‰åŒºåˆ«å°±æ„å‘³ç€ä¸ç®¡æ˜¯è·¯ç”±è°æ•æ‰åˆ°ï¼Œè¿˜æ˜¯è¿‡æ»¤å™¨çš„å…ˆåéƒ½æ˜¯æœ‰å…³ç³»çš„ã€‚ staic æä¾›äº†å¾ˆå¥½çš„é™æ€èµ„æºæœåŠ¡ï¼Œä½†æ˜¯è¦å¯¹é™æ€èµ„æºåšä¸€äº›å¤„ç†å°±å¾ˆéº»çƒ¦ã€‚æˆ‘çš„åšæ³•æ˜¯åœ¨ config next å­—æ®µåŠ å…¥ä¸€äº›å›è°ƒèƒ½è¿‡æŠ“å¾—åˆ° ctx ä¼ ä¸‹æ¥çš„ tokenã€‚å¯¹äºä¸€äº›ç”¨æˆ·ç›¸å…³çš„èµ„æºå¯ä»¥è¿™ä¹ˆåšä½†æ˜¯ä¸å»ºè®®ã€‚ ä¸­é—´ä»¶æ–‡ä»¶ç³»ç»Ÿæš‚æ—¶æ²¡çœ‹æ‡‚æ˜¯æ€ä¹ˆç”¨çš„ queryParseè¿™ä¸ªæ¥å£èƒ½å¤Ÿç›´æ¥å°† url ä¸Šçš„å‚æ•°ç”¨é€—å·åˆ†éš”ç¬¦è§£æåˆ° string æ•°ç»„å½“ä¸­ï¼Œä½†æ˜¯å¦‚æœä¸ä¼ å‚æ•°å°±ä¼šå¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸º 1 ç¬¬ä¸€ä½æ˜¯ç©ºå­—ç¬¦çš„å‚æ•° å¦å¤–è¿™ä¸ªå‡½æ•°çš„å®ç°åŸç†æ˜¯åå°„ï¼Œæ‰€ä»¥ä»–åªä¼šæ ¹æ®åå°„è·å–ç»“æ„åç§°ï¼Œjson æ ‡ç­¾ä¸èµ·ä½œç”¨ï¼Œè¦å®¢åˆ¶åŒ–çš„éœ€æ±‚åˆæƒ³ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å°±ä»åå°„è¿™å—ä¸‹åŠŸå¤«ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 func TestQueryParse(t *testing.T) { app := fiber.New() app.Get(\u0026#34;/\u0026#34;, func(ctx *fiber.Ctx) error { var res struct { Id int `json:\u0026#34;id\u0026#34;` NameAA string `json:\u0026#34;name_aA\u0026#34;` NameaA string `json:\u0026#34;namea_a\u0026#34;` } err := ctx.QueryParser(\u0026amp;res) if err != nil { return ctx.SendStatus(http.StatusInternalServerError) } t.Log(res) return ctx.SendStatus(http.StatusOK) }) req := httptest.NewRequest(\u0026#34;GET\u0026#34;, \u0026#34;/?id=23\u0026amp;nameAA=nameAA\u0026amp;namea_a=namea_a\u0026#34;, nil) resp, err := app.Test(req, -1) assert.NoError(t, err) all, err := io.ReadAll(resp.Body) assert.NoError(t, err) t.Log(string(all)) } /* === RUN TestQueryParse main_test.go:49: {23 nameAA } main_test.go:57: OK --- PASS: TestQueryParse (0.00s) */ gorm ç¯‡ ç»¼è¿°ï¼šgorm çš„å‘è¿˜æ˜¯éå¸¸å¤šçš„ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šç”¨é”™ï¼Œå¦‚æœç°åœ¨å¼€æ”¾å‡ºæ¥çš„å‡½æ•°ä¸èƒ½å®ç°éœ€æ±‚çš„è¯å»ºè®®è¿˜æ˜¯ç”¨raw()\næŸ¥è¯¢ç¯‡ where()æ–¹æ³•å’Œ or æ–¹æ³•ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œä»¥ or ä¸ºåˆ†ç•Œæ‹¼æ¥ sqlã€‚ç®€å•æ¥è¯´å°±æ˜¯ or ä¹‹åæ˜¯ä¸€ä¸ªæ–°çš„å­å¥ã€‚ first æ–¹æ³•åœ¨æŸ¥æ‰¾ä¸åˆ°è®°å½•çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ª notfound é”™è¯¯ï¼Œéœ€è¦åšå¤„ç†ï¼Œä½†æ˜¯ find ä¸ä¼šã€‚ åœ¨ç‰ˆæœ¬ 1.32.6 ç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨ç©ºå€¼ï¼Œå¹¶å°†æ•°æ®æŸ¥è¯¢ç»“æœå†™å…¥åˆ‡ç‰‡çš„æ—¶å€™ï¼Œè¡¨é¡¹çš„ç©ºï¼ˆNULLï¼‰å€¼ä¼šä½¿ç”¨ä¸Šä¸€æ¡æ•°æ®çš„å€¼ã€‚ åˆ›å»ºç¯‡ åœ¨ç»™ç±»å‹å†™ scanner valuer æ¥å£çš„æ—¶å€™ valuer çš„æ¥æ”¶è€…ä¸èƒ½æ˜¯æŒ‡é’ˆæ¥æ”¶è€…ï¼Œå¦åˆ™æ— æ³•è§¦å‘ç›¸å…³è¡Œä¸º å£°æ˜ç¯‡ é»˜è®¤çš„è¡¨åï¼Œå­—æ®µåæ˜¯é©¼å³°æ”¹è›‡å½¢ model å•æ•°ä¼šè‡ªåŠ¨åŠ å¤æ•° s table ä¸ä¼šè§¦å‘ hook åœ¨ gorm.DB çš„ model æ˜¯ä½¿ç”¨çš„æ—¶å€™è®¾ç½®çš„ï¼Œå¦‚æœè¿˜æƒ³ç»™ hook ä¼ é€’ä¿¡æ¯åªæœ‰é€šè¿‡ setï¼Œä½†æ˜¯è€ƒè™‘åˆ°å¹¶å‘çš„æ—¶å€™ï¼Œå¹¶ä¸å»ºè®®ç»™å•ä¾‹ setï¼Œå¯ä»¥ getinstance åšä¸€æ¬¡å…‹éš†åœ¨ç»™ db set ä¸€äº›å‚è€ƒçš„å‚æ•°ã€‚è€Œä¸” get éœ€è¦é€šè¿‡åˆ¶å®šçš„å…³é”®å­—è·å–ï¼Œè¿™å°±æ„å‘³ç€è¦å¯¹å‚æ•°åšçº¦å®šã€‚ä¸šåŠ¡ä¸€å¤šï¼Œçº¦å®šçš„å…³é”®å­—å°±æˆäº†å…³é”®å­—è¡¨ï¼Œä¸ç»Ÿä¸€ç®¡ç†å‰åä¸å¯¹ç…§ä¼š panic viperï¼ˆé…ç½®ç¯‡ï¼‰ moby ç¯‡ï¼ˆdockerï¼‰ reexec ç¯‡ moby ä¸‹ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„å·¥å…·åŒ…ï¼ŒåŸºæœ¬ä¸Šæ˜¯é›¶ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥æ‹·è´ä¸‹æ¥ä½¿ç”¨ã€‚ moby çš„åŸºæœ¬åŸç†æœ‰æ—¶é—´å†ç ”ç©¶ï¼Œè®²ä¸€ä¸‹æ³¨æ„ç‚¹ã€‚ ä»–ä¼šåœ¨ arg[0]é‡Œè®¾ç½®ä»»åŠ¡çš„ pid è®©ä¸»ç¨‹åºä½œä¸ºå­ç¨‹åºçš„å®ˆæŠ¤ï¼Œå¹¶ç®¡ç†å­ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœæƒ³è¦åšå®ˆæŠ¤å°±æ˜¯æ‹¿ç€ run()è¿”å›çš„ pid å»åå¤é‡å¯ä»»åŠ¡ã€‚\næºç é˜…è¯» cmd_windows.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package reexec // import \u0026#34;github.com/docker/docker/pkg/reexec\u0026#34; import ( \u0026#34;os/exec\u0026#34; ) // Self returns the path to the current process\u0026#39;s binary. // Uses os.Args[0]. func Self() string { return naiveSelf() } // Command returns *exec.Cmd which has Path as current binary. // For example if current binary is \u0026#34;docker.exe\u0026#34; at \u0026#34;C:\\\u0026#34;, then cmd.Path will // be set to \u0026#34;C:\\docker.exe\u0026#34;. func Command(args ...string) *exec.Cmd { return \u0026amp;exec.Cmd{ Path: Self(), Args: args, } } reexec.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // Package reexec facilitates the busybox style reexec of the docker binary that // we require because of the forking limitations of using Go. Handlers can be // registered with a name and the argv 0 of the exec of the binary will be used // to find and execute custom init paths. package reexec // import \u0026#34;github.com/docker/docker/pkg/reexec\u0026#34; import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/exec\u0026#34; \u0026#34;path/filepath\u0026#34; ) var registeredInitializers = make(map[string]func()) // Register adds an initialization func under the specified name // ä¸ä½œè¿‡å¤šè§£é‡Š ç”¨mapæ¥æ³¨å†Œä¸€ä¸ªéé‡å¤çš„è¿›ç¨‹åˆå§‹åŒ–å›è°ƒï¼Œåå­—å†²çªæ—¶panic func Register(name string, initializer func()) { if _, exists := registeredInitializers[name]; exists { panic(fmt.Sprintf(\u0026#34;reexec func already registered under name %q\u0026#34;, name)) } registeredInitializers[name] = initializer } // Init is called as the first part of the exec process and returns true if an // initialization function was called. func Init() bool { initializer, exists := registeredInitializers[os.Args[0]] if exists { initializer() return true } return false } func naiveSelf() string { name := os.Args[0] if filepath.Base(name) == name { if lp, err := exec.LookPath(name); err == nil { return lp } } // handle conversion of relative paths to absolute if absName, err := filepath.Abs(name); err == nil { return absName } // if we couldn\u0026#39;t get absolute name, return original // (NOTE: Go only errors on Abs() if os.Getwd fails) return name } å·¥å…·ä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 var args []string args = append(append(append(args, \u0026#34;xxx\u0026#34;), strconv.Itoa(os.Getpid())), os.Args[1:]...) reexec.Register(\u0026#34;xxx\u0026#34;, App) reexec.Register(\u0026#34;xxxxx\u0026#34;, AppSdk) if reexec.Init() { logger.Log.Error(\u0026#34;init mps process error\u0026#34;) os.Exit(0) } logger.Log.Infof(\u0026#34;[%v] process daemon process start ,os args [%v] -----------startTime--[ %v ]\u0026#34;, os.Getpid(), os.Args, time.Now().String()) go func() { var stdErr bytes.Buffer for { select { case \u0026lt;-OverChan: return default: cmd := reexec.Command(\u0026#34;xxxxx\u0026#34;, strconv.Itoa(os.Getpid())) cmd.Stderr = \u0026amp;stdErr err := cmd.Run() if err != nil { logger.Log.Errorf(\u0026#34;command error [%v]\\n\u0026#34;, stdErr.String()) } time.Sleep(restartDuration) } } }() var stdErr bytes.Buffer for { select { case \u0026lt;-OverChan: return default: cmd := reexec.Command(\u0026#34;xxx\u0026#34;, strconv.Itoa(os.Getpid())) cmd.Stderr = \u0026amp;stdErr err := cmd.Run() if err != nil { logger.Log.Errorf(\u0026#34;command error [%v]\\n\u0026#34;, stdErr.String()) } time.Sleep(restartDuration) } } ","date":"2023-02-24T00:00:00Z","permalink":"https://fangjionghao1.github.io/p/%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/","title":"webæœåŠ¡è¸©çš„å‘"},{"content":"èƒŒæ™¯ åœ¨å¼€å‘ http æœåŠ¡çš„æ—¶å€™æ—¥å¸¸è¦ä¿®ä¿®è¡¥è¡¥ï¼Œå…ä¸äº†è¦æš‚åœçº¿ä¸Šçš„æœåŠ¡ç„¶åå‘é€šå‘Šæ›´æ–°æœåŠ¡ï¼Œä¹‹åè¿›è¡Œéå¸¸ç´§å¼ çš„æ›´æ–°éƒ¨ç½²ï¼Œå¹¶åœ¨å°èŒƒå›´ç”¨ç‰¹æ®Šè´¦å·æµ‹è¯•åšä¸ªåŸºæœ¬çš„çº¿ä¸Šå›å½’ã€‚ åŠ å…¥éƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œè¿™æ—¶å€™å°±è¦ç»§ç»­å‘é€šå‘Šå»¶æœŸï¼Œä¹…äº†æ›´æ–°ç»´æŠ¤æ›´ç´§å¼ ã€‚ ä¸ºäº†è§£å†³ç»´æŠ¤çš„éº»çƒ¦ï¼Œé€‰æ‹©ä½¿ç”¨çƒ­éƒ¨ç½²çš„æ–¹å¼ã€‚è¿™æ ·å°±å¯ä»¥è®©ç”¨æˆ·é€æ˜çš„è®¿é—®ï¼Œè€Œåå°ä¹Ÿèƒ½æ­£å¸¸è¿›è¡Œç»´æŠ¤ã€‚\n##æ¦‚è¿°\n###ä»€ä¹ˆæ˜¯çƒ­éƒ¨ç½²\nå°±æ˜¯åœ¨åº”ç”¨æ­£åœ¨è¿è¡Œçš„æ—¶å€™å‡çº§è½¯ä»¶ï¼Œå´ä¸éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨ã€‚ ä½†æ˜¯å¯¹äºä¸åŒç±»å‹çš„è¯­è¨€æ¥è¯´ï¼Œçƒ­éƒ¨ç½²çš„æ„ä¹‰ä¸åŒã€‚ å¯¹äº è§£é‡Šå‹è¯­è¨€ï¼Œæˆ–è®¸å°±æ„å‘³ç€ä¸€æ¬¡æ›´æ–°ä»£ç ã€‚å› ä¸ºè§£é‡Šå‹è¯­è¨€åªéœ€è¦ä»å†…å­˜ä¸­è·å–ç›¸å…³æ–‡ä»¶ï¼Œæ‰€ä»¥å¾ˆç»å¸¸å‰ç«¯ä»£ç ä¸éœ€è¦æš‚åœæœåŠ¡ç›´æ¥æ›¿æ¢æ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨ã€‚ è€Œå¯¹äº ç¼–è¯‘å‹è¯­è¨€ åŸºæœ¬ä¸Šå°±æ„å‘³ç€ä¸¤ä¸ªä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ åŸºäºè¿™ä¸¤ä¸ªåŸºæœ¬è§‚ç‚¹ï¼Œè§£é‡Šå‹è¯­è¨€å’Œç¼–è¯‘å‹è¯­è¨€çš„çƒ­éƒ¨ç½²æ–¹æ¡ˆå°±æˆªç„¶ä¸åŒã€‚\næ¯”å¦‚å¸¸ç”¨çš„æœåŠ¡å™¨å¼€å‘è¯­è¨€ï¼Œjava,å¸¸è§çš„çƒ­éƒ¨ç½²æ–¹æ¡ˆå‚è€ƒ tomcatï¼Œdevtool çš„çƒ­é‡å¯ï¼Œ\nå› ä¸ºè¦ç¼–è¯‘ç„¶åè·‘åœ¨ jvm ä¸Šï¼Œç›´æ¥ç®€å•ç‚¹è®¤å®šæˆç¼–è¯‘å‹è¯­è¨€å§ï¼Œå…³äºè¿™ä¸ªç‚¹ä¸æ˜¯ä»Šå¤©è®¨è®ºçš„é‡ç‚¹ã€‚æœ‰æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨è¯„è®ºåŒºè®¨è®ºã€‚ ä»Šå¤©ä¸è®¨è®ºè§£é‡Šå‹è¯­è¨€çš„çƒ­éƒ¨ç½²æ–¹å¼æ²¡å› ä¸ºæ ¹æœ¬æ²¡è¿™ä¸ªæ¦‚å¿µï¼Œåƒ php çš„çƒ­éƒ¨ç½²å°±æ˜¯æ¢ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯æ¬¡è„šæœ¬éƒ½æ˜¯å»è¯»æ–‡ä»¶æ ¹æœ¬ä¸å­˜åœ¨ä¹‹å‰å’Œä¹‹åçš„åŒºåˆ«ã€‚\næ‹¿ devtool æ¥è®²ï¼Œä»–çš„åšæ³•æ˜¯åˆ†åˆ«åŠ è½½ä¿®æ”¹çš„ç±»å’Œä¸ä¿®æ”¹çš„ç±»ï¼Œå†å¾€ä¸‹æ˜¯ç›‘å¬æ–‡ä»¶ï¼Œå®ç°æ¯«ç§’çº§çš„ç¼–è¯‘é‡å¯ã€‚è¿™ç§åšæ³•æè¿°èµ·æ¥å°±æ˜¯ï¼Œæˆ‘ç¡®å®æ–­çº¿è¿‡ï¼Œä½†æ˜¯å¤ªçŸ­äº†ï¼ˆæ¯«ç§’ï¼‰å¯Ÿè§‰ä¸åˆ°ï¼Œç”¨çƒ­é‡å¯çš„æ–¹å¼æ¥å®ç°çƒ­éƒ¨ç½²ã€‚tomcat çš„æ€è·¯ä¹Ÿæ˜¯å·®ä¸å¤šå°±ä¸åœ¨èµ˜è¿°ã€‚\nå¦ä¸€ä¸ªçƒ­éƒ¨ç½²çš„æ–¹å¼å°±æ˜¯çƒ­æ›¿æ¢ã€‚ çƒ­æ›¿æ¢çš„æ€è·¯å¾ˆå¤šï¼Œ\næ¸¸æˆæœåŠ¡å™¨çš„æ€è·¯æ˜¯æŠŠä¸šåŠ¡ package ç¼–è¯‘æˆ pluginï¼ŒåŠ¨æ€åŠ è½½å’Œæ›¿æ¢ï¼Œå†é€šè¿‡ plugin.Lookup æ¥æŸ¥æ‰¾å’Œæ›¿æ¢å‡½æ•°ã€‚ ç¼ºç‚¹æ˜¯ï¼š å— Go Plugin æœ¬èº«çš„é™åˆ¶ï¼Œå¦‚ç¬¬ä¸‰æ–¹ä¾èµ–éœ€è¦ä¸€è‡´ã€ä¸èƒ½å¼•ç”¨æ’ä»¶ packageã€æ’ä»¶å†…æ•°æ®ç±»å‹å…±äº«ã€æ’ä»¶æ— æ³•é‡Šæ”¾ã€è°ƒè¯•ç›¸å¯¹å›°éš¾ã€è·¨å¹³å°é—®é¢˜ç­‰ å¯¹ä¸šåŠ¡ä»£ç ä¾µå…¥å¼è¾ƒå¼ºï¼ŒåŒ…æ‹¬ plugin main package é™åˆ¶ã€Lookup è°ƒç”¨æ–¹å¼ã€å‘å¸ƒæµç¨‹ç­‰ æˆ‘çš„åšæ³•æ˜¯ä»£ç†äº¤æ¥æœåŠ¡ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç¼–è¯‘äº†ä¸¤ä¸ªæœåŠ¡ï¼Œæˆ‘å…ˆè®©ä¸¤ä¸ªæœåŠ¡å¹¶å­˜ï¼Œå†è®©æµé‡è½¬åˆ°æ–°çš„æœåŠ¡ä¸Šä»è€Œæ¥ç®¡è¿‡å»çš„æœåŠ¡ã€‚å¬èµ·æ¥å¾ˆåƒä»£ç†ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººçš„åšæ³•æ˜¯ç”¨ä»£ç†çš„æ–¹å¼ã€‚ ##ç›®å‰æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆ\nä½¿ç”¨ä»£ç†æœåŠ¡ï¼Œå½“ç”¨æˆ·è®¿é—®çš„æ—¶å€™å®é™…ä¸Šæ˜¯è®¿é—®ä»£ç†æœåŠ¡ï¼Œä»£ç†æœåŠ¡ä¸ºæœåŠ¡å™¨è½¬å‘æµé‡åˆ°å½“å‰æœ€æ–°çš„æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨éµå®ˆè§„åˆ™ï¼š å®ç°æ³¨å†ŒæœåŠ¡,æœåŠ¡å¯åŠ¨æ—¶å‘ä»£ç†æœåŠ¡æ³¨å†Œè‡ªèº«ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸ä»…é™äºç‰ˆæœ¬å· å®ç°ä¿æ´»æœåŠ¡ï¼Œä»£ç†æœåŠ¡å°†ä¼šè®¿é—®æœåŠ¡å™¨çš„ä¿æ´»æ¥å£ï¼Œç¡®ä¿æœåŠ¡å™¨çš„å­˜æ´»çŠ¶æ€ã€‚ æœåŠ¡è¦æ±‚è¯†åˆ«ç‰¹æ®Šçš„è¿”å›ç»“æ„ï¼Œè¿™æ˜¯çº¦å®šå¥½çš„é€šä¿¡æ ¼å¼ï¼ŒåŒ…æ‹¬ä¸€äº›ç‰¹å®šçš„ codeï¼Œä¸ºäº†é¿å…æ±¡æŸ“ proxy çš„çº¯ç²¹æ€§ï¼Œå°½é‡ä¸è¦è®©è¿™ç§é€šä¿¡æ ¼å¼é‡Œé¢å¸¦æœ‰ä¸€äº›ä¸šåŠ¡çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬ token ä¹Ÿå°½é‡ä¸è¦å† proxy é‡Œé¢æœ‰æ¥å£ã€‚è¿™æ ·çš„çº¦å®šä¸€å®šæ˜¯åŸºäºæœåŠ¡çš„æŠ½è±¡ï¼Œæ¯”å¦‚é€šçŸ¥æœåŠ¡ä¸­æ–­ï¼ŒæœåŠ¡é‡å¯ï¼ŒæœåŠ¡å…³é—­ä¹‹ç±»çš„ï¼Œå°±ç›®å‰è€Œè¨€åªéœ€è¦æœ‰ä¸€ä¸ªæœåŠ¡é‡å¯çš„ä¿¡å·å’Œä¸€ä¸ªæœåŠ¡å…³é—­ä¿¡å·å°±å¥½ï¼Œè€Œå’Œä¸šåŠ¡äº§ç”Ÿå…³ç³»çš„åªæœ‰æœåŠ¡é‡å¯ã€‚ å¯¹äºä¸Šè¿°çš„è§„åˆ™åšä¸ªæ€»ç»“å°±æ˜¯ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸€ä¸ªä¿æ´»æœåŠ¡ã€æ¥æ”¶æœåŠ¡é‡å¯é€šçŸ¥çš„æœåŠ¡å’Œ rpc çš„å…³é—­ï¼Œå…·ä½“å®ç°çš„æ–¹å¼å…¶å®å› äººè€Œå¼‚ï¼Œå¯ä»¥é€‰æ‹© http çš„å°±æ˜¯å†™ä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…ä¸€ä¸ª grpc æœåŠ¡çƒ­éƒ¨ç½²çš„éš¾ç‚¹ï¼š æœ¬èº«æœåŠ¡çƒ­é‡å¯å…¶å®åšåˆ°ä»£ç†ä»¥åå®Œæˆäº†ä¸€å¤§åŠã€‚å› ä¸ºæœåŠ¡å™¨å†…éƒ¨å¹¶ä¸ä¼šå…±äº«ä¸€äº›èµ„æºï¼ŒåŒ…æ‹¬é…ç½®å’Œå†…å­˜éƒ½æ˜¯ç‹¬ç«‹åˆ†é…å’Œç‹¬ç«‹ä½¿ç”¨ã€‚ä¸€ä¸ªæœªå®Œæˆçš„æ¥å£è°ƒç”¨ä¹Ÿç”±åŸå…ˆçš„åç¨‹æ¥å®Œæˆï¼Œå®Œæˆåè¿™ä¸ªåç¨‹å°±å†ä¹Ÿæ— æ³•æ¥æ”¶åˆ°ä»£ç†ä¿¡æ¯ä¹Ÿå°±è‡ªç„¶å¯ä»¥ç”¨æœºåˆ¶æƒ³åŠæ³•å…³é—­ï¼Œproxy å†è‡ªç„¶å›æ”¶é‚£éƒ¨åˆ†å†…å­˜ã€‚é—®é¢˜å°±åœ¨äºä¸€ä¸ªé¡µé¢å¾€å¾€ä¸ä»…ä»…åªåŒ…å«ç€ä¸€ä¸ªæ¥å£è°ƒç”¨ã€‚ è¿˜æœ‰è¦æ˜ç¡®çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡çƒ­éƒ¨ç½²å¯¹äºç¼–è¯‘å‹è¯­è¨€ç¼–å†™çš„æœåŠ¡å™¨ï¼Œæ–‡ä»¶å±‚æ¬¡ä¸Šä¸€å®šæ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ˜¾è€Œæ˜“è§ä»–ä»¬æ˜¯ä¸åŒçš„æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å†…éƒ¨ç«¯å£åœ¨çƒ­éƒ¨ç½²çš„æ—¶å€™è‡³å°‘æ˜¯å æœ‰å¤æ•°ä¸ªçš„ è¯•æƒ³è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå‡å¦‚è¯´æˆ‘åœ¨åŠ è½½ä¸€ä¸ªç•Œé¢çš„æ—¶å€™è¿›è¡Œäº†çƒ­éƒ¨ç½²ï¼Œè¿™ä¸ªæ—¶å€™åŠ è½½äº†ä¸¤ç§æ¡ç›®ï¼Œåˆ†åˆ«æ¥è‡ªv1 å’Œ v2 ç¨‹åºå°±è¢«æ’•è£‚äº†ã€‚ å¦‚æœæ˜¯ tcp çš„æœåŠ¡å…¶å®å¯ä»¥è€ƒè™‘ï¼Œå½“æ–°çš„ä»£ç†è¿æ¥æ¥å…¥æ—¶æ ¹æ®æ ‡è®°åˆ¤æ–­å½“å‰è¿æ¥çš„ä½¿ç”¨çŠ¶æ€åœ¨å®Œæˆä¸šåŠ¡ä¹Ÿå°±æ˜¯å’Œå®¢æˆ·ç«¯æ–­å¼€è¿æ¥çš„æ—¶å€™ä¸»åŠ¨æ–­å¼€ä¸ä»£ç†çš„è¿æ¥ï¼Œé‡æ–°å»ºç«‹è¿æ¥â€”â€”â€”â€”é•¿è¿æ¥æ€»æ˜¯å¯ä»¥åœ¨è¿æ¥çŠ¶æ€ä¸Šåšæ–‡ç« ã€‚ http çš„æƒ³æ³•å°±ä¸é‚£ä¹ˆè‡ªç„¶ä¸€ç‚¹ã€‚æ–°çš„æœåŠ¡è¢«æ‹‰èµ·çš„æ—¶å€™ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡è¢«æ‹‰èµ·ä¹‹å‰æ²¡æœ‰ä»»ä½•æœåŠ¡è‡ªç„¶æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œä¸éœ€è¦ä»»ä½•æ“ä½œç›´æ¥æ¥å—ä»£ç†æœåŠ¡å™¨çš„æœåŠ¡å°±å¥½äº†ã€‚\nè€Œå¦ä¸€ç§æƒ…å†µå°±æ²¡è¿™ä¹ˆæ„‰å¿«ã€‚æœåŠ¡è¢«æ‹‰èµ·çš„æ—¶å€™æ–°æ—§æœåŠ¡è¦çŸ­æš‚çš„å¹¶è¡Œä¸€æ®µæ—¶é—´ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ç›´æ¥å…³é—­æ˜¯å¯èƒ½æœ‰æ­£åœ¨èµ°æ—§è¿æ¥çš„ä¸šåŠ¡ï¼Œç›´æ¥å…³é—­ä¼šè®©ä¸€éƒ¨åˆ†è¯·æ±‚çªç„¶ä¸¢å¤±ã€‚å¯¹åº”ç€ tcp çš„æƒ…å†µå°±æ˜¯æ£€æŸ¥è¿æ¥ä¸Šæ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ä¸šåŠ¡ã€‚è€Œåšè¿™ä¸ªæ£€æŸ¥çš„æ–¹å¼å°±æ˜¯åœ¨ä»£ç†æœåŠ¡å™¨è®°å½•è¯·æ±‚çš„æ—¶é—´ã€‚å†å…·ä½“ä¸‹å»é€‰æ‹©çš„æ•°æ®ç»“æ„æ¥æ‰¿è½½è¿™ä¸ªè¡Œä¸ºï¼Œé€‰æ‹©çš„æ˜¯ map\nå¯ä»¥æ°¸è¿œç›¸ä¿¡å¸¦è¯»å†™é”çš„ map æ¥å®ç°ä¸šåŠ¡ï¼Œè€Œéœ€è¦æ›´å¿«çš„æ£€ç´¢é€Ÿåº¦çš„æ—¶å€™å†è€ƒè™‘æ˜¯å¦æ¢å…¶ä»–æ›´é«˜æ•ˆçš„ç»“æ„ï¼Œä»¥åŠæ›´æ¢ç»“æ„å¸¦æ¥çš„é—®é¢˜ï¼Œä½¿ç”¨ç»“æ„å¸¦æ¥çš„å¤æ‚åº¦\nç”¨ map è®°å½•æœåŠ¡è¯·æ±‚çš„æ—¶é—´æˆ³è¶…è¿‡ 300s æ²¡æœ‰è¿›è¡Œè¯·æ±‚çš„æ—¶å€™å¯ä»¥å®‰å¿ƒæŠŠæœåŠ¡åˆ‡æ–­åˆ‡æ¢ï¼Œè½¬è€Œä½¿ç”¨æ–°çš„è¿æ¥ã€‚ä½¿ç”¨æ–°è¿æ¥ä¹‹åè¦åšç›¸åº”çš„æ‰«å°¾å·¥ä½œï¼ŒåŒ…æ‹¬åˆ é™¤ä»£ç†ä¸­çš„æ³¨å†Œä¿¡æ¯ï¼Œåˆ é™¤æ—¶é—´æˆ³ã€‚åŒæ—¶æ ‡è®°å¥½ä¸‹ä¸€æ¬¡ä¿æ´»å¿ƒè·³æ¥çš„æ—¶å€™ç»™åº”ç­”ä¸€ä¸ªæœåŠ¡é‡å¯ä¿¡å·ï¼Œè¿™ä¸ªæ˜¯è¯´ç»™æ—§æœåŠ¡å¬çš„ï¼Œæ—§æœåŠ¡å†è¯´ç»™å¤–éƒ¨æœåŠ¡ã€‚è®©å¤–éƒ¨æœåŠ¡æ¥åšä¸€æ¬¡å¤§æ›´æ–°ï¼ŒåŒ…æ‹¬åˆ·æ–° token å’Œä¸ªäººä¿¡æ¯ã€‚proxy åšå®Œè¿™äº›è¦åšä¸€æ¬¡å…³é—­æœåŠ¡çš„è°ƒç”¨ï¼Œæ­£å¼å‘Šåˆ«æ—§æœåŠ¡ï¼Œæ„å‘³ç€æ›´æ–°å®Œæˆã€‚\næœ¬ç¯‡ä¸»è¦æ˜¯æ–¹æ³•è®ºï¼Œå…·ä½“å®ç°ä¼šåœ¨åç»­æ›´æ–°ã€‚\n","date":"2023-02-20T00:00:00Z","image":"https://fangjionghao1.github.io/p/funjohnhow/_hu43d2d81e576066052a6f5913b37b6310_577754_121c9ab0b3dadf7b4b19129b45439ea9.png","permalink":"https://fangjionghao1.github.io/p/funjohnhow/","title":"çƒ­éƒ¨ç½²æ–¹æ¡ˆå°è®°"},{"content":"èƒŒæ™¯ æœ‰æ¬¡æœ‹å‹è·Ÿæˆ‘èŠèµ·ææ€–ç”µå½±ï¼Œè‡ªè¯©ç”µå½±çˆ±å¥½è€…èŠèµ·è¿™ä¸ªé¢†åŸŸçš„ä¸œè¥¿çš„æ—¶å€™å¼ å£å•Šé—­å£å—¯ï¼ŒåŠå¤©æ”¯å¾ä¸å‡ºä¸ªæ‰€ä»¥ç„¶æ¥ï¼Œæ‰€ä»¥åœ¨ä¸ªäººåšå®¢å¼€äº†è¿™ä¸ªåˆ†ç±»ï¼Œæƒ³è¦æ•´ç†ä¸€äº›å¹³å¸¸æ„Ÿå…´è¶£çš„é¢†åŸŸçš„æ¦‚å¿µã€‚\nåˆ†ç±»è¯´æ˜ è¯­æ–™è¡¨ç¤ºèŠå¤©éœ€è¦ç”¨åˆ°çš„æ¦‚å¿µæˆ–è€…æƒ³æ³•ï¼Œæå‰å†™åœ¨åšå®¢é‡Œé¢ã€‚ ç”µå½±è¿™ä¸ªåˆ†ç±»å°±å¾ˆæ˜æœ—äº†ï¼Œä¸å†è¯´æ˜\næ­£æ–‡ æ¦‚å¿µ è¯´æ˜ éº¦æ ¼èŠ¬ï¼ˆMacGuffinï¼‰æ‰‹æ³• â€”â€”åŸºæœ¬é‡Šä¹‰â€”â€”â‘  æŒ‡æŸä¸ªæ¨åŠ¨æˆå‰§å‘å±•çš„å¥‘æœºã€æƒ…èŠ‚ï¼Œæˆ–è§’è‰²ä»¬æ‹¼å‘½è¿½é€çš„å¯èƒ½ä¸å­˜åœ¨çš„ä¸œè¥¿ï¼Œè§‚ä¼—ä¹Ÿå¯èƒ½ä¸å…³å¿ƒï¼Œå®ƒå‡ºç°ç›®çš„åœ¨äºå¼•å¯¼è§‚ä¼—æ²‰æµ¸äºç”µå½±ä½“éªŒ â‘¡ å¼€ç«¯æ˜¯[ä¸‰åä¹çº§å°é˜¶]ï¼Œé€šè¿‡é˜¿å°”å¼—é›·å¾·Â·å¸ŒåŒºæŸ¯å…‹åœ¨å…¶åæ¥ç”µå½±ä¸­çš„ä½¿ç”¨æµè¡Œèµ·æ¥ã€‚* ä¸¾ä¾‹ï¼šâ€œä½ åœ¨åšä»€ä¹ˆï¼Ÿâ€â€œæˆ‘åœ¨æ‰¾éº¦æ ¼èŠ¬â€â€œéº¦æ ¼èŠ¬æ˜¯ä»€ä¹ˆâ€â€œæ•çŒåŒ—æ–¹å†°åŸä¸Šç‹®å­çš„æœ€å¥½æ­¦å™¨â€â€œå¯æ˜¯åŒ—æ–¹å†°åŸæ²¡æœ‰ç‹®å­â€â€œé‚£ä¹Ÿæ²¡æœ‰éº¦æ ¼èŠ¬â€ ã€‚éº¦æ ¼èŠ¬ï¼ŒæŒ‰ç…§å¸ŒåŒºæŸ¯å…‹çš„å®šä¹‰æ˜¯â€œæ‚¬ç–‘ç”µå½±ä¸­è§’è‰²ä»¬å¿…é¡»è¦æ‹¼å‘½è¿½é€ï¼Œå¯è§‚ä¼—å´å¯ä»¥æ¯«ä¸å…³å¿ƒçš„ä¸œè¥¿â€ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ç‰‡ä¸­ï¼Œå½“è¦å™è¿°çš„æ•…äº‹ï¼Œå†™å®åˆ°å¿…é¡»è¦æŠŠç ´åä»½å­çš„æ„å›¾å’Œç›®æ ‡äº¤ä»£æ¸…æ¥šçš„æ—¶å€™ï¼Œéº¦æ ¼èŠ¬å¤±æ•ˆäº†ã€‚å¤±æ•ˆçš„æœ€ç›´æ¥çš„åæœï¼Œå°±æ˜¯è§‚ä¼—å¯¹æ•…äº‹çœŸå®æ€§è¦æ±‚å¤§å¤§æé«˜äº†ã€‚å› ä¸ºä»–ä»¬çŸ¥é“äº†è§’è‰²åŠ¨æœºå’Œäº‹ä»¶çš„æ¥é¾™å»è„‰ï¼Œä»–ä»¬ä¹Ÿå°±çŸ¥é“äº†ï¼Œç›¸å¯¹åº”çš„åˆç†é€»è¾‘è¡Œä¸ºå…³ç³»åº”è¯¥æ˜¯ä»€ä¹ˆã€‚è€Œè¿™å¯¹æ‚¬ç–‘ç‰‡å¯¼æ¼”æ¥è¯´ï¼Œæ˜¯ååˆ†å¯æ€•çš„ã€‚å› ä¸ºä½ çš„å‰§æƒ…è®¾è®¡ä»»ä½•é€»è¾‘ä¸Šçš„ç¼ºé™·éƒ½å¾ˆå®¹æ˜“å°±è¢«æ”¾å¤§ï¼æ¯”å¦‚åœ¨æœ¬ç‰‡ä¸­ï¼Œå½“è§‚ä¼—äº†è§£åˆ°ç ´åä»½å­çš„æ”¿æ²»ç«‹åœºå’Œå‡¶æ®‹æœ¬æ€§ä¹‹åï¼Œé‚£ä¹ˆå½±ç‰‡ååŠæ®µï¼Œç”·ä¸»è§’åªæ˜¯è¢«æ‰“æ˜ï¼Œå´æ²¡æœ‰è¢«æ€æ­»è¿™ä¸ªæƒ…èŠ‚å°±å˜å¾—éš¾ä»¥ä»¤äººä¿¡æœã€‚ç›¸åï¼Œåœ¨ä¸€ä¸ªé«˜åº¦é£æ ¼åŒ–ã€å–œå‰§è½»æ¾ï¼Œä¸”éº¦æ ¼èŠ¬æœ‰æ•ˆçš„æ•…äº‹èƒŒæ™¯ä¸‹ï¼ˆæ¯”å¦‚è¥¿åŒ—ååŒ—ï¼‰ï¼Œè¿™äº›é—®é¢˜å°±å¾ˆå¯èƒ½ä¸æˆä¸ºé—®é¢˜ã€‚å› ä¸ºè§‚ä¼—ä¸æ¸…æ¥šï¼Œä¹Ÿæ ¹æœ¬ä¸å…³æ³¨åäººä»¬çš„è¡Œä¸ºé€»è¾‘ã€‚ ç‚¸å¼¹ç†è®º å¦‚æœæœ‰ä¸‰ä¸ªäººåœ¨ç©å„¿æ‰‘å…‹ç‰Œï¼Œåœ¨ç‰Œæ¡Œä¸‹æœ‰ä¸€é¢—ç‚¸å¼¹ã€‚å¦‚æœä½ åªæ˜¯è®²è¿°ä¸‰ä¸ªäººç©ç‰Œï¼Œç„¶åçªç„¶çˆ†ç‚¸äº†ï¼Œé‚£ä¹ˆæ•…äº‹å°±æ¯«æ— æ‚¬å¿µã€‚ä½†å¦‚æœä½ äº‹å…ˆå°†ç‚¸å¼¹çš„å­˜åœ¨å‘Šè¯‰è¯»è€…ï¼Œç„¶åå†å±•ç¤ºä¸‰ä¸ªä¸çŸ¥æƒ…çš„äººç©å„¿ç‰Œï¼Œé‚£ä¹ˆè§‚ä¼—å°±ä¼šæ—¶æ—¶åˆ»åˆ»å…³å¿ƒç‚¸å¼¹ä»€ä¹ˆæ—¶å€™çˆ†ç‚¸ã€‚è¿™å°±æ˜¯ç‚¸å¼¹ç†è®ºã€‚ç®€å•æ¥è¯´ï¼Œè¿™é‡Œç†è®ºå°±æ˜¯è®²ï¼Œéœ€è¦åœ¨æ•…äº‹å¼€å§‹å‰ï¼Œå‘è§‚ä¼—å±•ç¤ºä¸€ä¸ªå±æœºï¼Œè§‚ä¼—çŸ¥é“ï¼Œä½†å‰§æƒ…ä¸­çš„äººç‰©å¹¶ä¸çŸ¥é“ã€‚è€Œè¿™ä¸ªå±æœºä¼¼ä¹éšæ—¶éƒ½å¯èƒ½çˆ†å‘ã€‚è¿™æ ·ï¼Œä¾¿å½¢æˆäº†ä¸€ä¸ªæ‚¬å¿µå’Œæ•…äº‹å¼ åŠ›ã€‚è¿™é‡Œçš„ç‚¸å¼¹å¯ä»¥ä½¿éå¸¸æŠ½è±¡çš„ä¸œè¥¿ï¼Œéšç§˜çš„å…³ç³»ï¼Œä¸ç¨³å®šçš„å› ç´ ï¼Œè„†å¼±çš„æ„Ÿæƒ…ï¼Œä»»ä½•å¯¹äºè§‚ä¼—è€Œè¨€å·²çŸ¥çš„ä¸ç¨³å®šçš„å› ç´ éƒ½å¯ä»¥æ˜¯ç‚¸å¼¹ å™è¯¡ï¼ˆå™è¿°æ€§è¯¡è®¡ï¼‰ æ˜¯æµè¡Œäºæ¨ç†å°è¯´å†™ä½œçš„ä¸€ç§å†™ä½œæ‰‹æ³•ã€‚é€šè¿‡è¿ç”¨è¯­è¨€ä¸Šçš„æ­§ä¹‰ï¼Œæˆ–è€…å·æ¢æ–‡å­—ç»“æ„çš„æ–¹å¼ï¼Œä»¥è¾¾åˆ°è¯¯å¯¼è¯»è€…çš„ç›®çš„ã€‚ éšæ‰‹è®° è™½ç„¶æ˜çŸ¥é“è¯´è¯çš„æ—¶å€™ä¸çœ‹ç€å¯¹æ–¹ä¸å¤ªç¤¼è²Œï¼Œä¹Ÿç»™è‡ªå·±æ‰¾äº†å€Ÿå£æ˜¯ä¸€ç›´çœ‹ç€æ¯”è¾ƒæœ‰æ”»å‡»æ€§ï¼Œä½†æ˜¯è¯´å®è¯åˆ«äººåœ¨è®²åˆ°ä¸€åŠçªç„¶æ’å˜´å±å®æœ‰ç‚¹ä¸åˆé€‚ ","date":"2023-02-20T00:00:00Z","image":"https://fangjionghao1.github.io/p/%E8%AF%AD%E6%96%99%E6%95%B4%E7%90%86/2_hue29632e6cc72d9fc68bcf057123f6a80_4122094_120x120_fill_q75_box_smart1.jpg","permalink":"https://fangjionghao1.github.io/p/%E8%AF%AD%E6%96%99%E6%95%B4%E7%90%86/","title":"è¯­æ–™æ•´ç†"},{"content":"ç¯å¢ƒå‡†å¤‡ ç³»ç»Ÿç¯å¢ƒï¼šWindows 10 ä¸“ä¸šç‰ˆ\néœ€æ±‚ç¯å¢ƒï¼šgit,hugo,go(1.16 or â¬†),scoop(window åŒ…ç®¡ç†å™¨ ä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç†è§£æˆå’Œ npm å·®ä¸å¤šçš„ä¸œè¥¿)\nhugo å®‰è£…æ–‡æ¡£\nscoop å®‰è£…æ•™ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®‰è£… Hugo brew install hugo(mac ğŸ‘) scoop install hugo(win ğŸ‘) # åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç«™ï¼ˆæœ¬åœ°ï¼‰ hugo new site quickstart \u0026amp;\u0026amp; cd quickstart # æ‹‰å–stackä¸»é¢˜ git init git clone https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack # å°†å®ä¾‹ç½‘ç«™æ‹·è´åˆ°åšå®¢æ ¹ç›®å½•ä¸‹ cp -r themes/hugo-theme-stack/exampleSite/* ./ # åˆ é™¤config.tomlä»¥é˜²å†²çªï¼Œä¹‹åé…ç½®æ–‡ä»¶ä½¿ç”¨config.yaml rm config.toml # æ„å»ºé™æ€ç½‘ç«™æ–‡ä»¶ï¼Œå¹¶å¯åŠ¨ HTTP æœåŠ¡ hugo server -D äº‘å¼€å‘éƒ¨ç½²â€”â€”Github Pages æ‰˜ç®¡ å…ˆæ–°å»ºä¸€ä¸ª github ä»“åº“ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ xxx.github.io è¿™ä¸ªåŸŸåï¼Œé‚£ä¹ˆé¡¹ç›®åç§°å¿…é¡»å’Œç”¨æˆ·åä¸€è‡´ã€‚ ç¬¬ä¸€æ­¥ï¼Œæ¥åˆ° blog ç›®å½•ï¼Œç„¶ååˆå§‹åŒ– gitï¼Œå¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ 1 2 3 4 5 6 7 8 git init git add . git commit -m \u0026#39;init\u0026#39; git branch -M main git remote add origin https://.....git # å¦‚æœè®¤è¯å¤±è´¥ï¼Œé‚£ä¹ˆéœ€è¦é…ç½®ä¸€ä¸‹tokenï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤é…ç½® git remote set-url origin https://{token}@{github.com/{username}/{repo_name}.git} git push -u origin main ç¬¬äºŒæ­¥ï¼Œ**æ·»åŠ  gh-pages.yml æ–‡ä»¶ã€‚** åœ¨ blog ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªåç§°ä¸º.github çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨.github æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª workflows æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ workflows æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å« gh-pages.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 name: github pages permissions: contents: write on: push: branches: - main # Set a branch to deploy jobs: deploy: runs-on: ubuntu-20.04 steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;latest\u0026#39; # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public ç¬¬ä¸‰æ­¥ï¼ŒæŠŠæ–°ä»£ç æ¨é€åˆ° githubã€‚æŸ¥çœ‹ repo çš„ actions æŸ¥çœ‹æ˜¯å¦éƒ¨ç½²å®Œæˆï¼Œç­‰åˆ°éƒ¨ç½²å®Œï¼Œåˆ° settingâ†’pagesï¼Œå°†branch ä¿®æ”¹ä¸º gh-pagesï¼Œ ç‚¹å‡» saveã€‚ è¿‡ä¸€ä¼šï¼Œä½ çš„ä¸»é¡µåœ¨ github pages å°±æ‰˜ç®¡å¥½äº†ã€‚ ","date":"2023-02-13T00:00:00Z","image":"https://fangjionghao1.github.io/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-02-13_18-16-10_huee6ca11520b5c85a3054c81fb42c4215_39305_120x120_fill_box_smart1_3.png","permalink":"https://fangjionghao1.github.io/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","title":"ä»é›¶å¼€å§‹æ­å»ºä¸ªäººåšå®¢"},{"content":"è®¾è®¡æ¨¡å¼æ¦‚å¿µ ç®€è¿° è®¾è®¡æ¨¡å¼å°†ç®—æ³•å’Œå…·ä½“å®ç°çš„å¯¹è±¡åˆ†ç¦»\né—®é¢˜æè¿° è®¾è®¡äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¸åŒçš„ç±»éœ€è¦åšä¸€ä¸ªè¡Œä¸ºï¼Œå»è¾“å‡ºä¸€ä»½ä¿¡æ¯æ‘˜è¦ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºå·²ç»åœ¨çº¿ä¸Šç¨³å®šè¿è¡Œï¼Œç»„é•¿ä¸å¸Œæœ›ä½ å¯¹ç°æœ‰çš„ç±»ç ´åï¼ŒåŒæ—¶è´¨ç–‘å¾€ç±»ä¸­æ·»åŠ æ‘˜è¦çš„å¿…è¦æ€§ã€‚\né—®é¢˜è§£å†³ è¿™æ—¶å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ è®¿é—®è€…æ¨¡å¼ è®¿é—®è€…æ¨¡å¼å°†æ–°è¡Œä¸ºäº¤ç»™è®¿é—®è€…ï¼Œä¸åŒçš„ç±»å‹å¯¹äºè®¿é—®è€…æ‰§è¡Œä¸åŒçš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯å°†æ–°è¡Œä¸ºæ•´åˆåˆ°è®¿é—®è€…å½“ä¸­ã€‚ ä¸ªäººæ„Ÿè§‰è¿™æœ‰ç‚¹åƒè£…é¥°å™¨çš„è¡Œä¸ºï¼Œä¸åŒçš„æ˜¯è¿™ä¸ªè¡Œä¸ºæ˜¯ä¾èµ–äºå¤–éƒ¨çš„ä¸€ä¸ªè®¿é—®è€…ã€‚\nç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 package main import \u0026#34;fmt\u0026#34; // // DiffDiInfo // @author: FJH // @Description: ç”¨äºä¸€ç»„ç¨³å®šçš„ä¿¡æ¯é€šè¿‡è®¿é—®æ¨¡å¼è¾“å‡ºè‡ªå·±ä¸åŒç»´åº¦çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯é€šè¿‡è‡ªèº«ä¿¡æ¯æ•´åˆè€Œæ¥ // type DiffDiInfo interface { Acceptor(dimension Dimension) // æ¥æ”¶å…¥å£ï¼Œ ç”¨äºä¸åŒç»´åº¦çš„æ¥æ”¶ } type Dimension interface { FirstDimension(*T1) SecondDimension(*T2) } type T1 struct { info int } func (t *T1) Acceptor(dimension Dimension) { dimension.FirstDimension(t) } type DimensionHandler struct { data interface{} } func (d *DimensionHandler) FirstDimension(t1 *T1) { d.data = t1.info } func (d *DimensionHandler) SecondDimension(t2 *T2) { d.data = t2.info } type T2 struct { info string } func (t *T2) Acceptor(dimension Dimension) { dimension.SecondDimension(t) } type Manager struct { t1 T1 t2 T2 } func main() { manager := Manager{ t1: T1{1}, t2: T2{\u0026#34;2\u0026#34;}, } handler := DimensionHandler{} manager.t2.Acceptor(\u0026amp;handler) fmt.Println(handler.data) } å¦‚æœæƒ³è¦æ›´æç«¯çš„è®¿é—®è€…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®ä¾‹å……å½“è®¿é—®è€…ï¼Œåªä¸è¿‡è€¦åˆåº¦å°±é«˜äº†å¾ˆå¤šï¼Œé¡ºç€è¿™ä¸ªæƒ³æ³•ä¸‹å»ä»–å°±æ˜¯åœ¨è¿™ä¸ªç±»å‹ä¸Šå¼€äº†ä¸ªå£å­å†™äº†è£…é¥°å™¨ã€‚æ‰€ä»¥è€¦åˆç¨‹åº¦ä»é«˜åˆ°ä½æ˜¯ è£…é¥°\u0026gt;å¡«å……å®ä¾‹\u0026gt;è®¿é—®è€…\n","date":"2023-02-13T00:00:00Z","permalink":"https://fangjionghao1.github.io/p/%E7%AE%97%E6%B3%95/","title":"è®¾è®¡æ¨¡å¼å°è¯•ï¼ˆä¸€ï¼‰"},{"content":"é—®é¢˜èƒŒæ™¯ å†™æµ‹è¯•çš„æ—¶å€™éœ€è¦ mock è¯·æ±‚ï¼Œå‘ç°æ•´ä¸ªæµç¨‹ç›¸å½“å¤æ‚\nè¯»æ–‡ä»¶ æ‹·è´åˆ° multiform.Writer ç”¨ writer å†™ filed parse åˆ° multiform ä» http.Request å½“ä¸­å–å‡º multiform ","date":"0001-01-01T00:00:00Z","permalink":"https://fangjionghao1.github.io/p/","title":""}]